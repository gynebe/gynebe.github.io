class EmailJSResponseStatus{constructor(e=0,t="Network Error"){this.status=e,this.text=t}}let createWebStorage=()=>{if("undefined"!=typeof localStorage)return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}},store={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:createWebStorage()},buildOptions=e=>e?"string"==typeof e?{publicKey:e}:"[object Object]"===e.toString()?e:{}:{},init=(e,t="https://api.emailjs.com")=>{e&&(e=buildOptions(e),store.publicKey=e.publicKey,store.blockHeadless=e.blockHeadless,store.storageProvider=e.storageProvider,store.blockList=e.blockList,store.limitRate=e.limitRate,store.origin=e.origin||t)},sendPost=async(e,t,a={})=>{e=await fetch(store.origin+e,{method:"POST",headers:a,body:t}),a=await e.text(),t=new EmailJSResponseStatus(e.status,a);if(e.ok)return t;throw t},validateParams=(e,t,a)=>{if(!e||"string"!=typeof e)throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||"string"!=typeof t)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!a||"string"!=typeof a)throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},validateTemplateParams=e=>{if(e&&"[object Object]"!==e.toString())throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},isHeadless=e=>e.webdriver||!e.languages||0===e.languages.length,headlessError=()=>new EmailJSResponseStatus(451,"Unavailable For Headless Browser"),validateBlockListParams=(e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if("string"!=typeof t)throw"The BlockList watchVariable has to be a string"},isBlockListDisabled=e=>!e.list?.length||!e.watchVariable,getValue=(e,t)=>e instanceof FormData?e.get(t):e[t],isBlockedValueInParams=(e,t)=>{if(isBlockListDisabled(e))return!1;validateBlockListParams(e.list,e.watchVariable);t=getValue(t,e.watchVariable);return"string"==typeof t&&e.list.includes(t)},blockedEmailError=()=>new EmailJSResponseStatus(403,"Forbidden"),validateLimitRateParams=(e,t)=>{if("number"!=typeof e||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&"string"!=typeof t)throw"The LimitRate ID has to be a non-empty string"},getLeftTime=async(e,t,a)=>{a=Number(await a.get(e)||0);return t-Date.now()+a},isLimitRateHit=async(e,t,a)=>{if(t.throttle&&a){validateLimitRateParams(t.throttle,t.id);e=t.id||e;if(0<await getLeftTime(e,t.throttle,a))return!0;await a.set(e,Date.now().toString())}return!1},limitRateError=()=>new EmailJSResponseStatus(429,"Too Many Requests"),send=async(e,t,a,r)=>{var r=buildOptions(r),o=r.publicKey||store.publicKey,n=r.blockHeadless||store.blockHeadless,s=r.storageProvider||store.storageProvider,i={...store.blockList,...r.blockList},r={...store.limitRate,...r.limitRate};return n&&isHeadless(navigator)?Promise.reject(headlessError()):(validateParams(o,e,t),validateTemplateParams(a),a&&isBlockedValueInParams(i,a)?Promise.reject(blockedEmailError()):await isLimitRateHit(location.pathname,r,s)?Promise.reject(limitRateError()):(n={lib_version:"4.4.1",user_id:o,service_id:e,template_id:t,template_params:a},sendPost("/api/v1.0/email/send",JSON.stringify(n),{"Content-type":"application/json"})))},validateForm=e=>{if(!e||"FORM"!==e.nodeName)throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},findHTMLForm=e=>"string"==typeof e?document.querySelector(e):e,sendForm=async(e,t,a,r)=>{var r=buildOptions(r),o=r.publicKey||store.publicKey,n=r.blockHeadless||store.blockHeadless,s=store.storageProvider||r.storageProvider,i={...store.blockList,...r.blockList},r={...store.limitRate,...r.limitRate};return n&&isHeadless(navigator)?Promise.reject(headlessError()):(n=findHTMLForm(a),validateParams(o,e,t),validateForm(n),a=new FormData(n),isBlockedValueInParams(i,a)?Promise.reject(blockedEmailError()):await isLimitRateHit(location.pathname,r,s)?Promise.reject(limitRateError()):(a.append("lib_version","4.4.1"),a.append("service_id",e),a.append("template_id",t),a.append("user_id",o),sendPost("/api/v1.0/email/send-form",a)))};var emailjs={init:init,send:send,sendForm:sendForm,EmailJSResponseStatus:EmailJSResponseStatus};emailjs.init("c0UqVFYtByUWzi-5c");let availability={Porto:{1:{daySlots:{2:[{start:"10:20",end:"13:20"},{start:"15:00",end:"19:00"}],5:[{start:"10:20",end:"13:20"},{start:"15:00",end:"19:00"}]}},2:{daySlots:{2:[{start:"15:00",end:"18:00"}]}}},"Santo Tirso":{1:{daySlots:{1:[{start:"15:00",end:"19:00"}],3:[{start:"09:00",end:"12:40"}]}}}},currentStep=0,currentLang=document.documentElement.lang||"pt-PT",steps=document.querySelectorAll(".form-step"),form=document.getElementById("appointmentForm"),weekLabel=document.getElementById("weekLabel"),calendarTable=document.getElementById("calendarTable"),selectedSlotInput=document.getElementById("selectedSlot"),specialty=form.elements.specialty,location$1=form.elements.location,currentYear=(new Date).getFullYear(),currentMonth=(new Date).getMonth(),currentMonday=getMonday(new Date(currentYear,currentMonth,1));function showStep(a){steps.forEach((e,t)=>e.classList.toggle("active",t===a))}function getMonday(e){var t=(e=new Date(e)).getDay(),t=e.getDate()-t+(0===t?-6:1);return new Date(e.setDate(t))}function timeToDate(e,t){var[t,a]=t.split(":").map(Number),e=new Date(e);return e.setHours(t,a,0,0),e}function generateTimeSlotsForDate(e,t,a,r){var o=[];let n=timeToDate(e,t);for(var s=timeToDate(e,a);n<=s;)o.push(new Date(n)),n=new Date(n.getTime()+6e4*r);return o}function renderCalendar(r){selectedSlotInput.value="";let o=availability[location$1.value]?.[specialty.selectedIndex];var e=document.querySelector(".calendar"),t=new Date(currentYear,currentMonth,1),t=t.toLocaleString(currentLang,{month:"long"})+" "+t.getFullYear();if(weekLabel.innerHTML=`
        <div class="calendar-header">
            <button onclick="changeMonth(-1)">&lt;</button>
            <strong>${t}</strong>
            <button onclick="changeMonth(1)">&gt;</button>
        </div>
    `,o&&o.daySlots){e.style.display="block";let a=[...Array(5)].map((e,t)=>{var a=new Date(r);return a.setDate(r.getDate()+t),a});var t=a.map(e=>`<th>${e.toLocaleDateString(currentLang,{weekday:"short",day:"numeric",month:"numeric"})}</th>`).join(""),n=generateTimeSlotsForDate(new Date,"09:00","19:00",20).map(e=>{let t=e.toTimeString().slice(0,5);return`<tr>${a.map(a=>{var e=a.getDay();let r=timeToDate(a,t);return`<td class="${(o.daySlots[e]||[]).some(e=>{var t=timeToDate(a,e.start),e=timeToDate(a,e.end);return r>=t&&r<=e})?"slot":"disabled-slot"}" data-slot="${a.toLocaleDateString()+" "+t}">${t}</td>`}).join("")}</tr>`});calendarTable.innerHTML=`
        <table>
            <thead><tr>${t}</tr></thead>
            <tbody>${n.join("")}</tbody>
        </table>
    `,document.querySelectorAll(".slot").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".slot").forEach(e=>e.classList.remove("selected")),e.classList.add("selected"),selectedSlotInput.value=e.dataset.slot})})}else e.style.display="none",calendarTable.innerHTML=""}window.nextStep=function(){var e;for(e of steps[currentStep].querySelectorAll("input, select"))if(!e.checkValidity())return void e.reportValidity();showStep(++currentStep),renderCalendar(currentMonday)},window.prevStep=function(){showStep(--currentStep)},specialty.addEventListener("change",()=>renderCalendar(currentMonday)),location$1.addEventListener("change",()=>renderCalendar(currentMonday)),window.changeWeek=function(e){currentMonday.setDate(currentMonday.getDate()+7*e),currentYear=currentMonday.getFullYear(),currentMonth=currentMonday.getMonth(),renderCalendar(currentMonday)},window.changeMonth=function(e){var e=new Date(currentYear,currentMonth+e,1),t=e.getDay();6===t?e.setDate(e.getDate()+2):0===t&&e.setDate(e.getDate()+1),currentYear=e.getFullYear(),currentMonth=e.getMonth(),renderCalendar(currentMonday=getMonday(e))},form.addEventListener("submit",function(e){if(e.preventDefault(),!selectedSlotInput.value&&availability[form.elements.location.value]?.[form.elements.specialty.value])alert("Por favor selecione um horário.");else if(grecaptcha.getResponse()){let e={name:document.getElementById("name").value,email:document.getElementById("email").value,birthday:document.getElementById("birthday").value,contact:document.getElementById("contact").value,specialty:specialty.value,location:location$1.value,selectedSlot:selectedSlotInput.value||"Sem horário selecionado",notes:form.querySelector('[name="notes"]')?.value||""};emailjs.send("service_2mkemrj","template_yaezzgg",e).then(()=>{showStep(currentStep=0),emailjs.send("service_2mkemrj","template_ppny0sk",e).then(()=>{document.getElementById("statusMsg").textContent="Agendamento enviado com sucesso!",form.reset()}).catch(e=>{console.error("Erro no email do cliente:",e),document.getElementById("statusMsg").textContent="Erro ao enviar o e-mail de confirmação.",showStep(currentStep=0)})}).catch(e=>{console.error("Erro no email da clínica:",e),document.getElementById("statusMsg").textContent="Erro ao enviar. Tente novamente.",showStep(currentStep=0)})}else alert("Por favor confirma que não és um robô.")}),showStep(0);