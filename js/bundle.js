(()=>{var ke=Object.defineProperty;var Z=Object.getOwnPropertySymbols;var Pe=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;var ee=(e,t,o)=>t in e?ke(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,d=(e,t)=>{for(var o in t||(t={}))Pe.call(t,o)&&ee(e,o,t[o]);if(Z)for(var o of Z(t))Ee.call(t,o)&&ee(e,o,t[o]);return e};var c=class{constructor(t=0,o="Network Error"){this.status=t,this.text=o}};var te=()=>{if(typeof localStorage!="undefined")return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}};var a={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:te()};var S=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{};var oe=(e,t="https://api.emailjs.com")=>{if(!e)return;let o=S(e);a.publicKey=o.publicKey,a.blockHeadless=o.blockHeadless,a.storageProvider=o.storageProvider,a.blockList=o.blockList,a.limitRate=o.limitRate,a.origin=o.origin||t};var M=async(e,t,o={})=>{let s=await fetch(a.origin+e,{method:"POST",headers:o,body:t}),n=await s.text(),r=new c(s.status,n);if(s.ok)return r;throw r};var H=(e,t,o)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||typeof t!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!o||typeof o!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"};var re=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"};var B=e=>e.webdriver||!e.languages||e.languages.length===0;var F=()=>new c(451,"Unavailable For Headless Browser");var ne=(e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof t!="string")throw"The BlockList watchVariable has to be a string"};var xe=e=>{var t;return!((t=e.list)!=null&&t.length)||!e.watchVariable},De=(e,t)=>e instanceof FormData?e.get(t):e[t],$=(e,t)=>{if(xe(e))return!1;ne(e.list,e.watchVariable);let o=De(t,e.watchVariable);return typeof o!="string"?!1:e.list.includes(o)};var V=()=>new c(403,"Forbidden");var se=(e,t)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&typeof t!="string")throw"The LimitRate ID has to be a non-empty string"};var Le=async(e,t,o)=>{let s=Number(await o.get(e)||0);return t-Date.now()+s},C=async(e,t,o)=>{if(!t.throttle||!o)return!1;se(t.throttle,t.id);let s=t.id||e;return await Le(s,t.throttle,o)>0?!0:(await o.set(s,Date.now().toString()),!1)};var q=()=>new c(429,"Too Many Requests");var ae=async(e,t,o,s)=>{let n=S(s),r=n.publicKey||a.publicKey,i=n.blockHeadless||a.blockHeadless,v=n.storageProvider||a.storageProvider,p=d(d({},a.blockList),n.blockList),P=d(d({},a.limitRate),n.limitRate);return i&&B(navigator)?Promise.reject(F()):(H(r,e,t),re(o),o&&$(p,o)?Promise.reject(V()):await C(location.pathname,P,v)?Promise.reject(q()):M("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:r,service_id:e,template_id:t,template_params:o}),{"Content-type":"application/json"}))};var ie=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"};var Te=e=>typeof e=="string"?document.querySelector(e):e,le=async(e,t,o,s)=>{let n=S(s),r=n.publicKey||a.publicKey,i=n.blockHeadless||a.blockHeadless,v=a.storageProvider||n.storageProvider,p=d(d({},a.blockList),n.blockList),P=d(d({},a.limitRate),n.limitRate);if(i&&B(navigator))return Promise.reject(F());let E=Te(o);H(r,e,t),ie(E);let b=new FormData(E);return $(p,b)?Promise.reject(V()):await C(location.pathname,P,v)?Promise.reject(q()):(b.append("lib_version","4.4.1"),b.append("service_id",e),b.append("template_id",t),b.append("user_id",r),M("/api/v1.0/email/send-form",b))};var _={init:oe,send:ae,sendForm:le,EmailJSResponseStatus:c};_.init("c0UqVFYtByUWzi-5c");var me={Porto:{1:{daySlots:{2:[{start:"10:20",end:"13:20"},{start:"15:00",end:"19:00"}],5:[{start:"10:20",end:"13:20"},{start:"15:00",end:"19:00"}]}},2:{daySlots:{2:[{start:"15:00",end:"18:00"}]}}},"Santo Tirso":{1:{daySlots:{1:[{start:"15:00",end:"19:00"}],3:[{start:"09:00",end:"12:40"}]}}}},de="2.2.3",N={blockedDates:[],holidaysMessage:""},ue=[],m=0,g=document.documentElement.lang||"pt-PT",pe=document.querySelectorAll(".form-step"),y=document.getElementById("appointmentForm"),je=document.getElementById("weekLabel"),ce=document.getElementById("calendarTable"),O=document.getElementById("selectedSlot"),h=y.elements.specialty,T=y.elements.location,A=new Date().getFullYear(),K=new Date().getMonth(),u=fe(new Date);async function W(){try{let e=await fetch(`/calendar-rules.json?v=${de}`,{cache:"no-store"});e.ok?N=await e.json():console.error("Failed to load calendar rules:",e.status)}catch(e){console.error("Erro ao carregar regras do calend\xE1rio",e)}}async function J(){try{let e=await fetch(`/appointments.json?v=${de}`,{cache:"no-store"});e.ok?ue=await e.json():console.error("Failed to load appointments:",e.status)}catch(e){console.error("Erro ao carregar appointments.json",e)}}function k(e){pe.forEach((t,o)=>t.classList.toggle("active",o===e))}window.nextStep=function(){let e=pe[m].querySelectorAll("input, select");for(let t of e)if(!t.checkValidity()){t.reportValidity();return}m++,k(m),R(u)};window.prevStep=function(){m--,k(m)};function fe(e){e=new Date(e);let t=e.getDay(),o=e.getDate()-t+(t===0?-6:1);return new Date(e.setDate(o))}function j(e,t){let[o,s]=t.split(":").map(Number),n=new Date(e);return n.setHours(o,s,0,0),n}function Re(e,t,o,s){let n=[],r=j(e,t),i=j(e,o);for(;r<=i;)n.push(new Date(r)),r=new Date(r.getTime()+s*6e4);return n}function R(e){var z;O.value="";let t=(z=me[T.value])==null?void 0:z[h.selectedIndex],o=document.querySelector(".calendar"),s=new Date(A,K,1),n=`${s.toLocaleString(g,{month:"long"})} ${s.getFullYear()}`;if(je.innerHTML=`
        <div class="calendar-header">
            <button onclick="changeMonth(-1)">&lt;</button>
            <strong>${n}</strong>
            <button onclick="changeMonth(1)">&gt;</button>
        </div>
    `,!t||!t.daySlots){o.style.display="none",ce.innerHTML="";return}else o.style.display="block";let r=null;T.value==="Porto"?h.selectedIndex===1?r=1:h.selectedIndex===2&&(r=2):T.value==="Santo Tirso"&&h.selectedIndex===1&&(r=4);let i=ue.filter(l=>l.IdGabinete===r).map(l=>({start:new Date(l.DataInicio),end:new Date(l.DataFim)})),v=[...Array(5)].map((l,f)=>{let x=new Date(e);return x.setDate(e.getDate()+f),x}),p=new Date;p.setHours(0,0,0,0),p.setDate(p.getDate()+1);let P=v.map(l=>{let f=l<p,x=l.toLocaleDateString(g,{weekday:"short",day:"numeric",month:"numeric"});return`<th class="${f?"disabled-slot":""}">${x}</th>`}).join(""),E=h.selectedIndex===2?30:20,ge=Re(new Date,"09:00","19:00",E).map(l=>{let f=l.toTimeString().slice(0,5);return`<tr>${v.map(w=>{var X;let he=w.getDay(),D=j(w,f),be=t.daySlots[he]||[],U=(((X=N.holidays)==null?void 0:X[h.selectedIndex])||[]).includes(w.toISOString().split("T")[0]),G=be.some(L=>{let we=j(w,L.start),Se=j(w,L.end);return D>=we&&D<Se&&D>=p}),Q=G&&i.some(L=>D>=L.start&&D<L.end),ye=G&&!U&&!Q,ve=`${w.toLocaleDateString()} ${f}`,Y="disabled-slot",I="";return ye?Y="slot":Q?(Y="booked-slot",I="Hor\xE1rio j\xE1 ocupado"):U&&(I=N.holidaysMessage),`<td class="${Y}" 
                        data-slot="${ve}" 
                        ${I?`title="${I}"`:""}>
                        ${f}
                    </td>`}).join("")}</tr>`});ce.innerHTML=`
        <table>
            <thead><tr>${P}</tr></thead>
            <tbody>${ge.join("")}</tbody>
        </table>
    `,document.querySelectorAll(".slot").forEach(l=>{l.addEventListener("click",()=>{document.querySelectorAll(".slot").forEach(f=>f.classList.remove("selected")),l.classList.add("selected"),O.value=l.dataset.slot})})}h.addEventListener("change",()=>Promise.all([W(),J()]).then(()=>R(u)));T.addEventListener("change",()=>Promise.all([W(),J()]).then(()=>R(u)));window.changeWeek=async function(e){u.setDate(u.getDate()+e*7),A=u.getFullYear(),K=u.getMonth(),R(u)};window.changeMonth=function(e){let t=new Date(A,K+e,1),o=t.getDay();o===6?t.setDate(t.getDate()+2):o===0&&t.setDate(t.getDate()+1),A=t.getFullYear(),K=t.getMonth(),u=fe(t),R(u)};y.addEventListener("submit",function(e){var s,n;if(e.preventDefault(),!O.value&&((s=me[y.elements.location.value])!=null&&s[y.elements.specialty.value])){alert("Por favor selecione um hor\xE1rio.");return}if(!grecaptcha.getResponse()){alert("Por favor confirma que n\xE3o \xE9s um rob\xF4.");return}let o={name:document.getElementById("name").value,email:document.getElementById("email").value,birthday:document.getElementById("birthday").value,contact:document.getElementById("contact").value,specialty:h.value,location:T.value,selectedSlot:O.value||"Sem hor\xE1rio selecionado",notes:((n=y.querySelector('[name="notes"]'))==null?void 0:n.value)||""};_.send("service_2mkemrj","template_yaezzgg",o).then(()=>{m=0,k(m),_.send("service_2mkemrj","template_ppny0sk",o).then(()=>{let r=document.getElementById("statusMsg");g==="en"?r.textContent="Appointment request successfully submitted! Pending confirmation.":g==="es"?r.textContent="\xA1Solicitud de cita enviada correctamente! Pendiente de confirmaci\xF3n.":r.textContent="Pedido de agendamento enviado com sucesso! Pendente de confirma\xE7\xE3o.",y.reset()}).catch(r=>{console.error("Erro no email do cliente:",r);let i=document.getElementById("statusMsg");g==="en"?i.textContent="Error sending confirmation email. Please try again.":g==="es"?i.textContent="Error al enviar el correo electr\xF3nico de confirmaci\xF3n. Por favor, int\xE9ntalo de nuevo.":i.textContent="Erro ao enviar o e-mail de confirma\xE7\xE3o. Por favor tente novamente.",m=0,k(m)})}).catch(r=>{console.error("Erro no email da cl\xEDnica:",r);let i=document.getElementById("statusMsg");g==="en"?i.textContent="Error sending email. Please try again.":g==="es"?i.textContent="Error al enviar el correo electr\xF3nico. Por favor, int\xE9ntalo de nuevo.":i.textContent="Erro ao enviar o e-mail. Por favor tente novamente.",m=0,k(m)})});(async()=>(await W(),await J(),k(0)))();})();
