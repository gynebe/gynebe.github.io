(()=>{var Pe=Object.defineProperty;var oe=Object.getOwnPropertySymbols;var De=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var re=(e,t,o)=>t in e?Pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,u=(e,t)=>{for(var o in t||(t={}))De.call(t,o)&&re(e,o,t[o]);if(oe)for(var o of oe(t))xe.call(t,o)&&re(e,o,t[o]);return e};var c=class{constructor(t=0,o="Network Error"){this.status=t,this.text=o}};var ne=()=>{if(typeof localStorage!="undefined")return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}};var a={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:ne()};var C=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{};var se=(e,t="https://api.emailjs.com")=>{if(!e)return;let o=C(e);a.publicKey=o.publicKey,a.blockHeadless=o.blockHeadless,a.storageProvider=o.storageProvider,a.blockList=o.blockList,a.limitRate=o.limitRate,a.origin=o.origin||t};var M=async(e,t,o={})=>{let s=await fetch(a.origin+e,{method:"POST",headers:o,body:t}),n=await s.text(),r=new c(s.status,n);if(s.ok)return r;throw r};var R=(e,t,o)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||typeof t!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!o||typeof o!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"};var ae=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"};var F=e=>e.webdriver||!e.languages||e.languages.length===0;var H=()=>new c(451,"Unavailable For Headless Browser");var ie=(e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof t!="string")throw"The BlockList watchVariable has to be a string"};var Le=e=>{var t;return!((t=e.list)!=null&&t.length)||!e.watchVariable},Ue=(e,t)=>e instanceof FormData?e.get(t):e[t],B=(e,t)=>{if(Le(e))return!1;ie(e.list,e.watchVariable);let o=Ue(t,e.watchVariable);return typeof o!="string"?!1:e.list.includes(o)};var $=()=>new c(403,"Forbidden");var le=(e,t)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&typeof t!="string")throw"The LimitRate ID has to be a non-empty string"};var je=async(e,t,o)=>{let s=Number(await o.get(e)||0);return t-Date.now()+s},V=async(e,t,o)=>{if(!t.throttle||!o)return!1;le(t.throttle,t.id);let s=t.id||e;return await je(s,t.throttle,o)>0?!0:(await o.set(s,Date.now().toString()),!1)};var q=()=>new c(429,"Too Many Requests");var ce=async(e,t,o,s)=>{let n=C(s),r=n.publicKey||a.publicKey,l=n.blockHeadless||a.blockHeadless,T=n.storageProvider||a.storageProvider,S=u(u({},a.blockList),n.blockList),k=u(u({},a.limitRate),n.limitRate);return l&&F(navigator)?Promise.reject(H()):(R(r,e,t),ae(o),o&&B(S,o)?Promise.reject($()):await V(location.pathname,k,T)?Promise.reject(q()):M("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:r,service_id:e,template_id:t,template_params:o}),{"Content-type":"application/json"}))};var me=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"};var Ie=e=>typeof e=="string"?document.querySelector(e):e,de=async(e,t,o,s)=>{let n=C(s),r=n.publicKey||a.publicKey,l=n.blockHeadless||a.blockHeadless,T=a.storageProvider||n.storageProvider,S=u(u({},a.blockList),n.blockList),k=u(u({},a.limitRate),n.limitRate);if(l&&F(navigator))return Promise.reject(H());let D=Ie(o);R(r,e,t),me(D);let h=new FormData(D);return B(S,h)?Promise.reject($()):await V(location.pathname,k,T)?Promise.reject(q()):(h.append("lib_version","4.4.1"),h.append("service_id",e),h.append("template_id",t),h.append("user_id",r),M("/api/v1.0/email/send-form",h))};var _={init:se,send:ce,sendForm:de,EmailJSResponseStatus:c};_.init("c0UqVFYtByUWzi-5c");var pe={Porto:{1:{daySlots:{2:[{start:"10:20",end:"13:20"},{start:"15:00",end:"19:00"}],5:[{start:"10:20",end:"13:20"},{start:"15:00",end:"19:00"}]}},2:{daySlots:{2:[{start:"15:00",end:"18:00"}]}}},"Santo Tirso":{1:{daySlots:{1:[{start:"15:00",end:"19:00"}],3:[{start:"09:00",end:"12:40"}]}}}},fe="2.2.5",O={blockedDates:[],holidaysMessage:""},ge=[],d=0,b=document.documentElement.lang||"pt-PT",he=document.querySelectorAll(".form-step"),w=document.getElementById("appointmentForm"),Me=document.getElementById("weekLabel"),ue=document.getElementById("calendarTable"),A=document.getElementById("selectedSlot"),g=w.elements.specialty,j=w.elements.location,Y=new Date().getFullYear(),K=new Date().getMonth(),p=ye(new Date);async function J(){try{let e=await fetch(`/calendar-rules.json?v=${fe}`,{cache:"no-store"});e.ok?O=await e.json():console.error("Failed to load calendar rules:",e.status)}catch(e){console.error("Erro ao carregar regras do calend\xE1rio",e)}}async function z(){try{let e=await fetch(`/appointments.json?v=${fe}`,{cache:"no-store"});e.ok?ge=await e.json():console.error("Failed to load appointments:",e.status)}catch(e){console.error("Erro ao carregar appointments.json",e)}}function E(e){return new Date(e)}function N(e,t){let[o,s]=t.split(":").map(Number);return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),o,s,0))}function Re(e,t,o,s){let n=[],r=N(e,t),l=N(e,o);for(;r<l;)n.push(new Date(r)),r=new Date(r.getTime()+s*6e4);return n}function ye(e){e=new Date(e);let t=e.getUTCDay(),o=e.getUTCDate()-t+(t===0?-6:1);return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),o))}function P(e){he.forEach((t,o)=>t.classList.toggle("active",o===e))}window.nextStep=function(){let e=he[d].querySelectorAll("input, select");for(let t of e)if(!t.checkValidity()){t.reportValidity();return}d++,P(d),I(p)};window.prevStep=function(){d--,P(d)};function I(e){var G;A.value="";let t=(G=pe[j.value])==null?void 0:G[g.selectedIndex],o=document.querySelector(".calendar"),s=new Date(Date.UTC(Y,K,1)),n=`${s.toLocaleString(b,{month:"long"})} ${s.getUTCFullYear()}`;if(Me.innerHTML=`
        <div class="calendar-header">
            <button onclick="changeMonth(-1)">&lt;</button>
            <strong>${n}</strong>
            <button onclick="changeMonth(1)">&gt;</button>
        </div>
    `,!t||!t.daySlots){o.style.display="none",ue.innerHTML="";return}else o.style.display="block";let r=null;j.value==="Porto"?g.selectedIndex===1?r=1:g.selectedIndex===2&&(r=2):j.value==="Santo Tirso"&&g.selectedIndex===1&&(r=4);let l=ge.filter(i=>i.IdGabinete===r).map(i=>({start:E(i.DataInicio),end:E(i.DataFim)})),T=[...Array(5)].map((i,y)=>{let x=new Date(e);return x.setUTCDate(e.getUTCDate()+y),x}),S=new Date;S.setUTCHours(0,0,0,0);let k=new Date(S.getTime()+1440*60*1e3),D=T.map(i=>{let y=i<k,x=i.toLocaleDateString(b,{weekday:"short",day:"numeric",month:"numeric"});return`<th class="${y?"disabled-slot":""}">${x}</th>`}).join(""),h=g.selectedIndex===2?30:20,be=Re(new Date,"09:00","19:00",h).map(i=>{let y=i.toISOString().substr(11,5);return`<tr>${T.map(v=>{var ee,te;let ve=v.getUTCDay(),f=new Date(Date.UTC(v.getUTCFullYear(),v.getUTCMonth(),v.getUTCDate(),i.getUTCHours(),i.getUTCMinutes())),Q=(t.daySlots[ve]||[]).some(m=>{let Ce=N(v,m.start),Ee=N(v,m.end);return f>=Ce&&f<Ee&&f>=k}),we=((ee=O.holidays)==null?void 0:ee[g.selectedIndex])||[],Te=((te=O.openExceptions)==null?void 0:te[g.selectedIndex])||[],X=we.some(m=>f>=E(m.DataInicio)&&f<E(m.DataFim)),L=Te.some(m=>f>=E(m.DataInicio)&&f<E(m.DataFim)),Z=l.some(m=>f>=m.start&&f<m.end&&(Q||L)),Se=(Q||L)&&!Z&&!X||L,ke=`${v.toLocaleDateString()} ${y}`,W="disabled-slot",U="";return Se?W="slot":Z?(W="booked-slot",U="Hor\xE1rio j\xE1 ocupado"):X&&!L?U=O.holidaysMessage:L&&(U="Aberto excecionalmente"),`<td class="${W}" data-slot="${ke}" ${U?`title="${U}"`:""}>${y}</td>`}).join("")}</tr>`});ue.innerHTML=`
        <table>
            <thead><tr>${D}</tr></thead>
            <tbody>${be.join("")}</tbody>
        </table>
    `,document.querySelectorAll(".slot").forEach(i=>{i.addEventListener("click",()=>{document.querySelectorAll(".slot").forEach(y=>y.classList.remove("selected")),i.classList.add("selected"),A.value=i.dataset.slot})})}g.addEventListener("change",()=>Promise.all([J(),z()]).then(()=>I(p)));j.addEventListener("change",()=>Promise.all([J(),z()]).then(()=>I(p)));window.changeWeek=async function(e){p.setUTCDate(p.getUTCDate()+e*7),Y=p.getUTCFullYear(),K=p.getUTCMonth(),I(p)};window.changeMonth=function(e){let t=new Date(Date.UTC(Y,K+e,1)),o=t.getUTCDay();o===6?t.setUTCDate(t.getUTCDate()+2):o===0&&t.setUTCDate(t.getUTCDate()+1),Y=t.getUTCFullYear(),K=t.getUTCMonth(),p=ye(t),I(p)};w.addEventListener("submit",function(e){var s,n;if(e.preventDefault(),!A.value&&((s=pe[w.elements.location.value])!=null&&s[w.elements.specialty.value])){alert("Por favor selecione um hor\xE1rio.");return}if(!grecaptcha.getResponse()){alert("Por favor confirma que n\xE3o \xE9s um rob\xF4.");return}let o={name:document.getElementById("name").value,email:document.getElementById("email").value,birthday:document.getElementById("birthday").value,contact:document.getElementById("contact").value,specialty:g.value,location:j.value,selectedSlot:A.value||"Sem hor\xE1rio selecionado",notes:((n=w.querySelector('[name="notes"]'))==null?void 0:n.value)||""};_.send("service_2mkemrj","template_yaezzgg",o).then(()=>{d=0,P(d),_.send("service_2mkemrj","template_ppny0sk",o).then(()=>{let r=document.getElementById("statusMsg");b==="en"?r.textContent="Appointment request successfully submitted! Pending confirmation.":b==="es"?r.textContent="\xA1Solicitud de cita enviada correctamente! Pendiente de confirmaci\xF3n.":r.textContent="Pedido de agendamento enviado com sucesso! Pendente de confirma\xE7\xE3o.",w.reset()}).catch(r=>{console.error("Erro no email do cliente:",r);let l=document.getElementById("statusMsg");b==="en"?l.textContent="Error sending confirmation email. Please try again.":b==="es"?l.textContent="Error al enviar el correo electr\xF3nico de confirmaci\xF3n. Por favor, int\xE9ntalo de nuevo.":l.textContent="Erro ao enviar o e-mail de confirma\xE7\xE3o. Por favor tente novamente.",d=0,P(d)})}).catch(r=>{console.error("Erro no email da cl\xEDnica:",r);let l=document.getElementById("statusMsg");b==="en"?l.textContent="Error sending email. Please try again.":b==="es"?l.textContent="Error al enviar el correo electr\xF3nico. Por favor, int\xE9ntalo de nuevo.":l.textContent="Erro ao enviar o e-mail. Por favor tente novamente.",d=0,P(d)})});(async()=>(await J(),await z(),P(0)))();})();
